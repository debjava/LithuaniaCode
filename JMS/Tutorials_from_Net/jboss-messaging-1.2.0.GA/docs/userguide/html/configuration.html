<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;8.&nbsp;Configuration</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="JBoss Messaging 1.2 User's Guide"><link rel="up" href="index.html" title="JBoss Messaging 1.2 User's Guide"><link rel="previous" href="examples.html" title="Chapter&nbsp;7.&nbsp;Running the Examples"><link rel="next" href="c_configuration.html" title="Chapter&nbsp;9.&nbsp;JBoss Messaging Clustering Configuration"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;8.&nbsp;Configuration</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="examples.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="c_configuration.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="configuration"></a>Chapter&nbsp;8.&nbsp;Configuration</h2></div></div><div></div></div><p>
      The JMS API specifies how a messaging client interacts with a messaging server. The exact
      definition and implementation of messaging services, such as message destinations and
      connection factories, are specific to JMS providers. JBoss Messaging has its own
      configuration files to configure services. If you are migrating services from JBossMQ
      (or other JMS provider) to JBoss Messaging, you will need to understand those
      configuration files.
  </p><p>
      In this chapter, we discuss how to configure various services inside JBoss Messaging,
      which work together to provide JMS API level services to client applications.
  </p><p>
      Starting with the JBoss Messaging 1.0.1 release, the service configuration is spread among
      several configuration files (the 1.0.0 release used to have all configuration information
      lumped together in the SAR's deployment descriptor
      <tt class="filename">jboss-messaging.sar/META-INF/jboss-service.xml</tt>).
      Depending on the functionality provided by the services it configures, the configuration
      data is distributed between
      <tt class="filename">messaging-service.xml</tt>,
      <tt class="filename">remoting-service.xml</tt>,
      <tt class="filename">xxx-persistence-service.xml</tt>
       (or <tt class="filename">clustered-xxx-persistence-service.xml</tt> for a clustered configuration,
       more about clusterered configuration in <a href="c_configuration.html" title="Chapter&nbsp;9.&nbsp;JBoss Messaging Clustering Configuration">Chapter&nbsp;9, <i>JBoss Messaging Clustering Configuration</i></a>),
      <tt class="filename">connection-factories-service.xml</tt> and
      <tt class="filename">destinations-service.xml</tt>.
   </p><p>
      The AOP client-side and server-side interceptor stacks are configured in
      <tt class="filename">aop-messaging-client.xml</tt> and <tt class="filename">aop-messaging-server.xml</tt>.
      Normally you will not want to change them, but you can some of the interceptors can be removed
      to give a small performance increase, if you don't need them. Be very careful you have considered the security implications before removing the
      security interceptor.
   </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="conf.serverpeer"></a>8.1.&nbsp;Configuring the ServerPeer</h2></div></div><div></div></div><p>
       The Server Peer is the "heart" of the JBoss Messaging JMS facade. The server's configuration,
       resides in <tt class="filename">messaging-service.xml</tt> configuration file.
    </p><p>All JBoss Messaging services are rooted at the server peer</p><p>An example of a Server Peer configuration is presented below. Note that not all values for the server peer's attributes are
     specified in the example</p><pre class="programlisting">
 &lt;mbean code="org.jboss.jms.server.ServerPeer"
        name="jboss.messaging:service=ServerPeer"
        xmbean-dd="xmdesc/ServerPeer-xmbean.xml"&gt;

   &lt;constructor&gt;
     &lt;!-- ServerPeerID --&gt;
     &lt;arg type="int" value="0"/&gt;
     &lt;!-- DefaultQueueJNDIContext --&gt;
     &lt;arg type="java.lang.String" value="/queue"/&gt;
     &lt;!-- DefaultTopicJNDIContext --&gt;
     &lt;arg type="java.lang.String" value="/topic"/&gt;
   &lt;/constructor&gt;

   &lt;attribute name="PostOffice"&gt;jboss.messaging:service=PostOffice&lt;/attribute&gt;
   &lt;attribute name="SecurityDomain"&gt;java:/jaas/messaging&lt;/attribute&gt;
   &lt;attribute name="DefaultSecurityConfig"&gt;
      &lt;security&gt;
        &lt;role name="guest" read="true" write="true" create="true"/&gt;
      &lt;/security&gt;
   &lt;/attribute&gt;
   &lt;attribute name="DefaultDLQ"&gt;
       jboss.messaging.destination:service=Queue,name=DLQ&lt;/attribute&gt;
   &lt;attribute name="DefaultMaxDeliveryAttempts"&gt;10&lt;/attribute&gt;
   &lt;attribute name="DefaultExpiryQueue"&gt;
       jboss.messaging.destination:service=Queue,name=ExpiryQueue&lt;/attribute&gt;
   &lt;attribute name="DefaultRedeliveryDelay"&gt;0&lt;/attribute&gt;
   &lt;attribute name="QueueStatsSamplePeriod"&gt;5000&lt;/attribute&gt;
   &lt;attribute name="FailoverStartTimeout"&gt;60000&lt;/attribute&gt;
   &lt;attribute name="FailoverCompleteTimeout"&gt;300000&lt;/attribute&gt;
   &lt;attribute name="DefaultMessageCounterHistoryDayLimit"&gt;-1&lt;/attribute&gt;

   &lt;depends optional-attribute-name="PersistenceManager"&gt;
       jboss.messaging:service=PersistenceManager&lt;/depends&gt;
   &lt;depends optional-attribute-name="JMSUserManager"&gt;
       jboss.messaging:service=JMSUserManager&lt;/depends&gt;
   &lt;depends&gt;jboss.messaging:service=Connector,transport=bisocket&lt;/depends&gt;

 &lt;/mbean&gt;
     </pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="conf.serverpeer.attributes"></a>8.1.1.&nbsp;
             We now discuss the MBean attributes of the ServerPeer MBean
        </h3></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.persistencemanager"></a>8.1.1.1.&nbsp;PersistenceManager</h4></div></div><div></div></div><p>
              This is the persistence manager that the ServerPeer uses. You will not normally need to change this attribute.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.postoffice"></a>8.1.1.2.&nbsp;PostOffice</h4></div></div><div></div></div><p>
              This is the post office that the ServerPeer uses. You will not normally need to change this attribute.
              The post office is responsible for routing messages to queues and maintaining the mapping between addresses and queues.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.jmsusermanager"></a>8.1.1.3.&nbsp;JMSUserManager</h4></div></div><div></div></div><p>
              This is the JMS user manager that the ServerPeer uses. You will not normally need to change this attribute.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.defaultdlq"></a>8.1.1.4.&nbsp;DefaultDLQ</h4></div></div><div></div></div><p>
              This is the name of the default DLQ (Dead Letter Queue) the server peer will use for destinations. The DLQ can be overridden on a per
              destination basis - see the destination MBean configuration for more details.

              A DLQ is a special destination where messages are sent when the server has attempted to deliver them unsuccessfully more than a certain number of
              times.

              If the DLQ is not specified at all then the message will be removed after the maximum number of delivery attempts.

              The maximum number of delivery attempts can be specified using the attribute DefaultMaxDeliveryAttempts for a global default or individually
              on a per destination basis.

           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.defaultexpiryqueue"></a>8.1.1.5.&nbsp;DefaultExpiryQueue</h4></div></div><div></div></div><p>
              This is the name of the default expiry queue the server peer will use for destinations. The expiry can be overridden on a per
              destination basis - see the destination MBean configuration for more details.

              An expiry queue is a special destination where messages are sent when they have expired. Message expiry is determined by the value of
              Message::getJMSExpiration()

              If the expiry queue is not specified at all then the message will be removed after it is expired.

           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.serverpeerid"></a>8.1.1.6.&nbsp;ServerPeerID</h4></div></div><div></div></div><p>
              The unique id of the server. In a cluster each server MUST have a unique id.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.defaultqueuejndicontext"></a>8.1.1.7.&nbsp;DefaultQueueJNDIContext</h4></div></div><div></div></div><p>
              The default JNDI context to use when binding queues. Defaults to /queue.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.defaultopicjndicontext"></a>8.1.1.8.&nbsp;DefaultTopicJNDIContext</h4></div></div><div></div></div><p>
              The default JNDI context to use when binding topics. Defaults to /topic.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.destinations"></a>8.1.1.9.&nbsp;Destinations</h4></div></div><div></div></div><p>
              Returns a list of the destinations (queues and topics) currently deployed.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.defaultmaxdeliveryattempts"></a>8.1.1.10.&nbsp;DefaultMaxDeliveryAttempts</h4></div></div><div></div></div><p>
              The default for the maximum number of times delivery of a message will be attempted before sending the message to the DLQ, if configured.
           </p><p>
              The default value is <tt class="literal">10</tt>
           </p><p>This value can also be overridden on a per destination basis</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.failoverstarttimeout"></a>8.1.1.11.&nbsp;FailoverStartTimeout</h4></div></div><div></div></div><p>
              The maximum number of milliseconds the client will wait for failover to start on the server side when a problem is detected.
           </p><p>
              The default value is <tt class="literal">60000</tt> (one minute)
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.failovercompletetimeout"></a>8.1.1.12.&nbsp;FailoverCompleteTimeout</h4></div></div><div></div></div><p>
              The maximum number of milliseconds the client will wait for failover to complete on the server side after it has started.
           </p><p>
              The default value is <tt class="literal">300000</tt> (five minutes)
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.defaultredliverydelay"></a>8.1.1.13.&nbsp;DefaultRedeliveryDelay</h4></div></div><div></div></div><p>
              When redelivering a message after failure of previous delivery it is often beneficial to introduce a delay perform redelivery in order
              to prevent thrashing of delivery-failure, delivery-failure etc
           </p><p>
              The default value is <tt class="literal">0</tt> which means there will be no delay.
           </p><p>Change this if your application could benefit with a delay before redelivery. This value can also be overridden on a per destination basis</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.queuestatssampleperiod"></a>8.1.1.14.&nbsp;QueueStatsSamplePeriod</h4></div></div><div></div></div><p>
              Periodically the server will query each queue to gets its message statistics. This is the period.
           </p><p>
              The default value is <tt class="literal">10000</tt> milliseconds
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.defaultmessagecounterhistorydaylimit"></a>8.1.1.15.&nbsp;DefaultMessageCounterHistoryDayLimit</h4></div></div><div></div></div><p>
                 JBoss Messaging provides a message counter history which shows the number of messages arriving on each queue of a certain number of
                 days. This attribute represents the maxiumum number of days for which to store message counter history. It can be overridden on a per
                 destination basis
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.messagecounters"></a>8.1.1.16.&nbsp;MessageCounters</h4></div></div><div></div></div><p>
                 JBoss Messaging provides a message counter for each queue.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.messagecounterstatistics"></a>8.1.1.17.&nbsp;MessageCountersStatistics</h4></div></div><div></div></div><p>
                 JBoss Messaging provides statistics for each message counter for each queue.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.attributes.defaultsecurity"></a>8.1.1.18.&nbsp;DefaultSecurityConfig</h4></div></div><div></div></div><p>
              Default security configuration is used when the security configuration for a specific
              queue or topic has not been overridden in the destination's deployment descriptor.
              It has exactly the same syntax and semantics as in JBossMQ.
           </p><p>
              The <tt class="literal">DefaultSecurityConfig</tt> attribute element should contain
              one <tt class="literal">&lt;security&gt;</tt> element.
              The <tt class="literal">&lt;security&gt;</tt> element can contain multiple
              <tt class="literal">&lt;role&gt;</tt> elements. Each <tt class="literal">&lt;role&gt;</tt>
              element defines the default access for that particular role.
           </p><p>
              If the <tt class="literal">read</tt> attribute is <tt class="literal">true</tt> then that role
              will be able to read (create consumers, receive messaages or browse) destinations
              by default.
           </p><p>
              If the <tt class="literal">write</tt> attribute is <tt class="literal">true</tt> then that role
              will be able to write (create producers or send messages) to destinations by default.
           </p><p>
              If the <tt class="literal">create</tt> attribute is <tt class="literal">true</tt> then that role
              will be able to create durable subscriptions on topics by default.
           </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="conf.serverpeer.operations"></a>8.1.2.&nbsp;
             We now discuss the MBean operations of the ServerPeer MBean
        </h3></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.deployQueue"></a>8.1.2.1.&nbsp;DeployQueue</h4></div></div><div></div></div><p>
              This operation lets you programmatically deploy a queue.
           </p><p>There are two overloaded versions of this operation</p><p>If the queue already exists but is undeployed it is deployed. Otherwise it is created and deployed</p><p>The <tt class="literal">name</tt> parameter represents the name of the destination to deploy.</p><p>The <tt class="literal">jndiName</tt> parameter (optional) represents the full jndi name where to bind the destination. If this is not specified
           then the destination will be bound in &lt;DefaultQueueJNDIContext&gt;/&lt;name&gt;</p><p>The first version of this operation deploys the destination with the default paging parameters. The second overloaded version deploys
           the destination with the specified paging parameters. See the section on configuring destinations for a discussion of what the
           paging parameters mean</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.undeployQueue"></a>8.1.2.2.&nbsp;UndeployQueue</h4></div></div><div></div></div><p>
              This operation lets you programmatically undeploy a queue.
           </p><p>The queue is undeployed but is NOT removed from persistent storage.</p><p>This operation returns <tt class="literal">true</tt> if the queue was successfull undeployed. otherwise it returns <tt class="literal">false</tt></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.destroyQueue"></a>8.1.2.3.&nbsp;DestroyQueue</h4></div></div><div></div></div><p>
              This operation lets you programmatically destroy a queue.
           </p><p>The queue is undeployed and then all its data is destroyed from the database</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>Be careful when using this method since it will delete all data for the queue</div><p>This operation returns <tt class="literal">true</tt> if the queue was successfully destroyed. otherwise it returns <tt class="literal">false</tt></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.deployTopic"></a>8.1.2.4.&nbsp;DeployTopic</h4></div></div><div></div></div><p>
              This operation lets you programmatically deploy a topic.
           </p><p>There are two overloaded versions of this operation</p><p>If the topic already exists but is undeployed it is deployed. Otherwise it is created and deployed</p><p>The <tt class="literal">name</tt> parameter represents the name of the destination to deploy.</p><p>The <tt class="literal">jndiName</tt> parameter (optional) represents the full jndi name where to bind the destination. If this is not specified
           then the destination will be bound in &lt;DefaultTopicJNDIContext&gt;/&lt;name&gt;</p><p>The first version of this operation deploys the destination with the default paging parameters. The second overloaded version deploys
           the destination with the specified paging parameters. See the section on configuring destinations for a discussion of what the
           paging parameters mean</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.undeployTopic"></a>8.1.2.5.&nbsp;UndeployTopic</h4></div></div><div></div></div><p>
              This operation lets you programmatically undeploy a topic.
           </p><p>The queue is undeployed but is NOT removed from persistent storage.</p><p>This operation returns <tt class="literal">true</tt> if the topic was successfully undeployed. otherwise it returns <tt class="literal">false</tt></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.destroyTopic"></a>8.1.2.6.&nbsp;DestroyTopic</h4></div></div><div></div></div><p>
              This operation lets you programmatically destroy a topic.
           </p><p>The topic is undeployed and then all its data is destroyed from the database</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>Be careful when using this method since it will delete all data for the topic</div><p>This operation returns <tt class="literal">true</tt> if the topic was successfully destroyed. otherwise it returns <tt class="literal">false</tt></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.listmessagecountersashtml"></a>8.1.2.7.&nbsp;ListMessageCountersHTML</h4></div></div><div></div></div><p>
              This operation returns message counters in an easy to display HTML format.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.resetallmessagecounters"></a>8.1.2.8.&nbsp;ResetAllMesageCounters</h4></div></div><div></div></div><p>
              This operation resets all message counters to zero.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.resetallmessagecounterhistories"></a>8.1.2.9.&nbsp;ResetAllMesageCounters</h4></div></div><div></div></div><p>
              This operation resets all message counter histories to zero.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.enablemessagecounters"></a>8.1.2.10.&nbsp;EnableMessageCounters</h4></div></div><div></div></div><p>
              This operation enables all message counters for all destinations. Message counters are disabled by default.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.disablemessagecounters"></a>8.1.2.11.&nbsp;DisableMessageCounters</h4></div></div><div></div></div><p>
              This operation disables all message counters for all destinations. Message counters are disabled by default.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.retrievepreparedtransactions"></a>8.1.2.12.&nbsp;RetrievePreparedTransactions</h4></div></div><div></div></div><p>
              Retrieves a list of the Xids for all transactions currently in a prepared state on the node.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.serverpeer.operations.showpreparedtransactions"></a>8.1.2.13.&nbsp;ShowPreparedTransactions</h4></div></div><div></div></div><p>
              Retrieves a list of the Xids for all transactions currently in a prepared state on the node in an easy to display HTML format.
           </p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="conf.changingds"></a>8.2.&nbsp;Changing the Database</h2></div></div><div></div></div><p>
               Several JBoss Messaging services interact with persistent storage. They include: The Persistence Manager,
               The PostOffice and the JMS User Manager.
               The Persistence Manager is used to handle the message-related persistence.
               The Post Office handles binding related persistence.
               The JMS User manager handles user related persistence
               The configuration for all these MBeans is handled in the <tt class="filename">xxx-persistence-service.xml</tt> file
        </p><p>
           If the database you want to switch to is one of MySQL, Oracle, PostgreSQL, MS SQL Sever or Sybase,
           persistence configuration files are already available in
           the <tt class="filename">examples/config</tt> directory of the release bundle.
        </p><p>
           In order to enable support for one of these databases, just replace the default
           <tt class="filename">hsqldb-persistence-service.xml</tt> configuration file with the
           database-specific configuration file and restart the server.
        </p><p>
           Also, be aware that by default, the Messaging services relying on a datastore
           are referencing <tt class="literal">"java:/DefaultDS"</tt> for the datasource.
           If you are deploying a datasource with a different JNDI name, you need to update
           all the <tt class="literal">DataSource</tt> attribute in the persistence configuration file.

           Example data source configurations for each of the popular databases are available in the distribution.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="conf.postoffice"></a>8.3.&nbsp;Configuring the Post office</h2></div></div><div></div></div><p>It is the job of the post office to route messages to their destination(s).
    </p><p>The post office maintains the mappings between addresses to which messages can be sent and their final queues.</p><p>For example when sending a message with an address that represents a JMS queue name, the post office will route this to a single
    queue - the JMS queue. When sending a message with an address that repesents a JMS topic name, the post office will route this to a set of
    queues - one for each JMS subscription.</p><p>The post office also handles the persistence for the mapping of addresses</p><p>JBoss Messaging comes with two different post office implementations - depending on whether you want clustering or not. The clustered post office
    has the ability to route messages to other nodes in the cluster</p><p>Whether you use the clustered post office or not depends on whether you deploy the <tt class="literal">clustered-xxx-persistence-service.xml</tt> MBean config
    or just the non clustered <tt class="literal">xxx-persistence-service.xml</tt> file.</p><p>It is likely that in future releases of JBoss Messaging the clustered and non clustered post offices will be combined into a single post office for
    ease of configuration</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="conf.postoffice.nonclustered"></a>8.3.1.&nbsp;Non clustered post office</h3></div></div><div></div></div><p>The non clustered post office should be used where clustering is not required. It will be used when the
       non clustered <tt class="literal">xxx-persistence-service.xml</tt> file is deployed.</p><p>Here is an example of a non clustered post office configuration:</p><pre class="programlisting">

&lt;mbean code="org.jboss.messaging.core.plugin.DefaultPostOfficeService"
      name="jboss.messaging:service=PostOffice"
      xmbean-dd="xmdesc/DefaultPostOffice-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.jca:service=DataSourceBinding,name=DefaultDS&lt;/depends&gt;
      &lt;depends optional-attribute-name="TransactionManager"&gt;jboss:service=TransactionManager&lt;/depends&gt;
      &lt;attribute name="PostOfficeName"&gt;JMS&lt;/attribute&gt;
      &lt;attribute name="DataSource"&gt;java:/DefaultDS&lt;/attribute&gt;
      &lt;attribute name="CreateTablesOnStartup"&gt;true&lt;/attribute&gt;
      &lt;attribute name="SqlProperties"&gt;&lt;![CDATA[
CREATE_POSTOFFICE_TABLE=CREATE TABLE JBM_POSTOFFICE (POSTOFFICE_NAME VARCHAR(255), NODE_ID INTEGER, QUEUE_NAME VARCHAR(1023), COND VARCHAR(1023), SELECTOR VARCHAR(1023), CHANNEL_ID BIGINT, CLUSTERED CHAR(1))
INSERT_BINDING=INSERT INTO JBM_POSTOFFICE (POSTOFFICE_NAME, NODE_ID, QUEUE_NAME, COND, SELECTOR, CHANNEL_ID, CLUSTERED) VALUES (?, ?, ?, ?, ?, ?, ?)
DELETE_BINDING=DELETE FROM JBM_POSTOFFICE WHERE POSTOFFICE_NAME=? AND NODE_ID=? AND QUEUE_NAME=?
LOAD_BINDINGS=SELECT NODE_ID, QUEUE_NAME, COND, SELECTOR, CHANNEL_ID, CLUSTERED FROM JBM_POSTOFFICE WHERE POSTOFFICE_NAME  = ?
      ]]&gt;&lt;/attribute&gt;
   &lt;/mbean&gt;

       </pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.postoffice.nonclustered.attributes"></a>8.3.1.1.&nbsp;The non clustered post office has the following attributes</h4></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.nonclustered.attributes.datasource"></a>8.3.1.1.1.&nbsp;DataSource</h5></div></div><div></div></div><p>The datasource the postoffice should use for persisting its mapping data</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.nonclustered.attributes.sqlproperties"></a>8.3.1.1.2.&nbsp;SQLProperties</h5></div></div><div></div></div><p>
                            This is where the DDL and DML for the particular database is specified.
                            If a particular DDL or DML statement is not overridden, the default Hypersonic
                            configuration will be used for that statement.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.nonclustered.attributes.createtables"></a>8.3.1.1.3.&nbsp;CreateTablesOnStartup</h5></div></div><div></div></div><p>
                  Set this to <tt class="literal">true</tt> if you wish the post office to attempt
                  to create the tables (and indexes) when it starts. If the tables (or indexes)
                  already exist a <tt class="literal">SQLException</tt> will be thrown by the JDBC driver and
                  ignored by the Persistence Manager, allowing it to continue.
               </p><p>
                  By default the value of <tt class="literal">CreateTablesOnStartup</tt> attribute
                  is set to <tt class="literal">true</tt>
               </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.nonclustered.attributes.postofficename"></a>8.3.1.1.4.&nbsp;PostOfficeName</h5></div></div><div></div></div><p>
                  The name of the post office
               </p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="conf.postoffice.clustered"></a>8.3.2.&nbsp;Clustered post office</h3></div></div><div></div></div><p>The clustered post office should be used where clustering is required. It will be used when the
       clustered <tt class="literal">clustered-xxx-persistence-service.xml</tt> file is deployed.</p><p>Here is an example of a clustered post office configuration:</p><pre class="programlisting">

&lt;mbean code="org.jboss.messaging.core.plugin.ClusteredPostOfficeService"
      name="jboss.messaging:service=PostOffice"
      xmbean-dd="xmdesc/ClusteredPostOffice-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.jca:service=DataSourceBinding,name=DefaultDS&lt;/depends&gt;
      &lt;depends optional-attribute-name="TransactionManager"&gt;jboss:service=TransactionManager&lt;/depends&gt;
      &lt;attribute name="PostOfficeName"&gt;Clustered JMS&lt;/attribute&gt;
      &lt;attribute name="DataSource"&gt;java:/DefaultDS&lt;/attribute&gt;
      &lt;attribute name="CreateTablesOnStartup"&gt;true&lt;/attribute&gt;
      &lt;attribute name="SqlProperties"&gt;&lt;![CDATA[
CREATE_POSTOFFICE_TABLE=CREATE TABLE JBM_POSTOFFICE (POSTOFFICE_NAME VARCHAR(255), NODE_ID INTEGER, QUEUE_NAME VARCHAR(1023), COND VARCHAR(1023), SELECTOR VARCHAR(1023), CHANNEL_ID BIGINT, CLUSTERED CHAR(1))
INSERT_BINDING=INSERT INTO JBM_POSTOFFICE (POSTOFFICE_NAME, NODE_ID, QUEUE_NAME, COND, SELECTOR, CHANNEL_ID, CLUSTERED) VALUES (?, ?, ?, ?, ?, ?, ?)
DELETE_BINDING=DELETE FROM JBM_POSTOFFICE WHERE POSTOFFICE_NAME=? AND NODE_ID=? AND QUEUE_NAME=?
LOAD_BINDINGS=SELECT NODE_ID, QUEUE_NAME, COND, SELECTOR, CHANNEL_ID, CLUSTERED FROM JBM_POSTOFFICE WHERE POSTOFFICE_NAME  = ?
      ]]&gt;&lt;/attribute&gt;
      &lt;attribute name="GroupName"&gt;DefaultPostOffice&lt;/attribute&gt;
      &lt;attribute name="StateTimeout"&gt;5000&lt;/attribute&gt;
      &lt;attribute name="CastTimeout"&gt;5000&lt;/attribute&gt;
      &lt;attribute name="StatsSendPeriod"&gt;10000&lt;/attribute&gt;
      &lt;attribute name="MessagePullPolicy"&gt;org.jboss.messaging.core.plugin.postoffice.cluster.NullMessagePullPolicy&lt;/attribute&gt;
      &lt;attribute name="ClusterRouterFactory"&gt;org.jboss.messaging.core.plugin.postoffice.cluster.DefaultRouterFactory&lt;/attribute&gt;


      &lt;attribute name="ChannelFactoryName"&gt;jgroups.mux:name=Multiplexer&lt;/attribute&gt;
      &lt;attribute name="SyncChannelName"&gt;udp-sync&lt;/attribute&gt;
      &lt;attribute name="AsyncChannelName"&gt;udp&lt;/attribute&gt;
      &lt;attribute name="ChannelPartitionName"&gt;${jboss.partition.name:DefaultPartition}-JMS&lt;/attribute&gt;

      &lt;attribute name="AsyncChannelConfig"&gt;
         &lt;config&gt;
            &lt;UDP mcast_recv_buf_size="500000" down_thread="false" ip_mcast="true" mcast_send_buf_size="32000"
           mcast_port="45567" ucast_recv_buf_size="500000" use_incoming_packet_handler="false"
           mcast_addr="228.8.8.8" use_outgoing_packet_handler="true" loopback="true" ucast_send_buf_size="32000" ip_ttl="32" bind_addr="127.0.0.1"/&gt;
            &lt;AUTOCONF down_thread="false" up_thread="false"/&gt;
            &lt;PING timeout="2000" down_thread="false" num_initial_members="3" up_thread="false"/&gt;
            &lt;MERGE2 max_interval="10000" down_thread="false" min_interval="5000" up_thread="false"/&gt;
            &lt;FD_SOCK down_thread="false" up_thread="false"/&gt;
            &lt;FD timeout="20000" max_tries="3" down_thread="false" up_thread="false" shun="true"/&gt;
            &lt;VERIFY_SUSPECT timeout="1500" down_thread="false" up_thread="false"/&gt;
            &lt;pbcast.NAKACK max_xmit_size="8192" down_thread="false" use_mcast_xmit="true" gc_lag="50" up_thread="false"
                         retransmit_timeout="100,200,600,1200,2400,4800"/&gt;
            &lt;UNICAST timeout="1200,2400,3600" down_thread="false" up_thread="false"/&gt;
            &lt;pbcast.STABLE stability_delay="1000" desired_avg_gossip="20000" down_thread="false" max_bytes="0" up_thread="false"/&gt;
            &lt;FRAG frag_size="8192" down_thread="false" up_thread="false"/&gt;
            &lt;VIEW_SYNC avg_send_interval="60000" down_thread="false" up_thread="false" /&gt;
            &lt;pbcast.GMS print_local_addr="true" join_timeout="3000" down_thread="false" join_retry_timeout="2000" up_thread="false" shun="true"/&gt;
         &lt;/config&gt;
      &lt;/attribute&gt;

      &lt;attribute name="SyncChannelConfig"&gt;
         &lt;config&gt;
            &lt;UDP mcast_recv_buf_size="500000" down_thread="false" ip_mcast="true" mcast_send_buf_size="32000"
           mcast_port="45568" ucast_recv_buf_size="500000" use_incoming_packet_handler="false"
           mcast_addr="228.8.8.8" use_outgoing_packet_handler="true" loopback="true" ucast_send_buf_size="32000" ip_ttl="32" bind_addr="127.0.0.1"/&gt;
            &lt;AUTOCONF down_thread="false" up_thread="false"/&gt;
            &lt;PING timeout="2000" down_thread="false" num_initial_members="3" up_thread="false"/&gt;
            &lt;MERGE2 max_interval="10000" down_thread="false" min_interval="5000" up_thread="false"/&gt;
            &lt;FD_SOCK down_thread="false" up_thread="false"/&gt;
            &lt;FD timeout="20000" max_tries="3" down_thread="false" up_thread="false" shun="true"/&gt;
            &lt;VERIFY_SUSPECT timeout="1500" down_thread="false" up_thread="false"/&gt;
            &lt;pbcast.NAKACK max_xmit_size="8192" down_thread="false" use_mcast_xmit="true" gc_lag="50" up_thread="false"
                         retransmit_timeout="100,200,600,1200,2400,4800"/&gt;
            &lt;UNICAST timeout="1200,2400,3600" down_thread="false" up_thread="false"/&gt;
            &lt;pbcast.STABLE stability_delay="1000" desired_avg_gossip="20000" down_thread="false" max_bytes="0" up_thread="false"/&gt;
            &lt;FRAG frag_size="8192" down_thread="false" up_thread="false"/&gt;
            &lt;VIEW_SYNC avg_send_interval="60000" down_thread="false" up_thread="false" /&gt;
            &lt;pbcast.GMS print_local_addr="true" join_timeout="3000" down_thread="false" join_retry_timeout="2000" up_thread="false" shun="true"/&gt;
            &lt;pbcast.STATE_TRANSFER down_thread="false" up_thread="false"/&gt;
         &lt;/config&gt;
      &lt;/attribute&gt;
   &lt;/mbean&gt;

       </pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.postoffice.clustered.attributes"></a>8.3.2.1.&nbsp;The nclustered post office has the following attributes</h4></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.datasource"></a>8.3.2.1.1.&nbsp;DataSource</h5></div></div><div></div></div><p>The datasource the postoffice should use for persisting its mapping data</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.sqlproperties"></a>8.3.2.1.2.&nbsp;SQLProperties</h5></div></div><div></div></div><p>
                            This is where the DDL and DML for the particular database is specified.
                            If a particular DDL or DML statement is not overridden, the default Hypersonic
                            configuration will be used for that statement.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.createtables"></a>8.3.2.1.3.&nbsp;CreateTablesOnStartup</h5></div></div><div></div></div><p>
                  Set this to <tt class="literal">true</tt> if you wish the post office to attempt
                  to create the tables (and indexes) when it starts. If the tables (or indexes)
                  already exist a <tt class="literal">SQLException</tt> will be thrown by the JDBC driver and
                  ignored by the Persistence Manager, allowing it to continue.
               </p><p>
                  By default the value of <tt class="literal">CreateTablesOnStartup</tt> attribute
                  is set to <tt class="literal">true</tt>
               </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.postofficename"></a>8.3.2.1.4.&nbsp;PostOfficeName</h5></div></div><div></div></div><p>
                  The name of the post office
               </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.nodeidview"></a>8.3.2.1.5.&nbsp;NodeIDView</h5></div></div><div></div></div><p>
                  This returns set containing the node ids of all the nodes in the cluster
               </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.groupname"></a>8.3.2.1.6.&nbsp;GroupName</h5></div></div><div></div></div><p>
                  All post offices in the cluster with the same group name will form a cluster together. Make sure the group name matches with
                  all the nodes in the cluster you want to form a cluster with.
               </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.messagepullpolicy"></a>8.3.2.1.7.&nbsp;MessagePullPolicy</h5></div></div><div></div></div><p>
                  JBoss Messaging has the ability for queues on one node to pull messages from other nodes when they have exhausted their local messages.
               </p><p>This prevents messages from getting stranded on nodes with slow or no consumers, and balances out message processing across the cluster.</p><p>How, if and when messages are pulled from one node to another is determined by the MessagePullPolicy</p><p>By default this set to <tt class="literal">org.jboss.messaging.core.plugin.postoffice.cluster.NullMessagePullPolicy</tt> which is a dummy
               implementation which never pulls messages from one node to another.</p><p>Whether you need message redistribution or not depends on your application topology - please see the section on clustering configuration for
               more details</p><p>If you require message redistribution then set this value to <tt class="literal">org.jboss.messaging.core.plugin.postoffice.cluster.NullMessagePullPolicy</tt>
               </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>Enabling message redistribution can result in the strict JMS message ordering guarantee being lost (i.e. the order of receipt of messages from
               a particular producer is retained). If this is not acceptable then do not enable message redistribution.</div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.clusterrouterfactory"></a>8.3.2.1.8.&nbsp;ClusterRouterFactory</h5></div></div><div></div></div><p>
                  When a message arrives on a node - JBoss Messaging needs to decide whether to route it to a local queue or a remote queue on a different node.
               </p><p>This setting allows you to specify the factory that determines this routing</p><p>By default this set to <tt class="literal">org.jboss.messaging.core.plugin.postoffice.cluster.DefaultRouterFactory</tt> which always favours
               a local queue if one is available otherwise it round robins amongst other queues.</p><p>The particular router factory you require depends on your application topology - please see the section on clustering configuration for
               more details</p><p>Other values this attribute can be set to are <tt class="literal">org.jboss.messaging.core.plugin.postoffice.cluster.RoundRobinRouterFactory</tt>
               if you do not want to favour the local queue.
               </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.statetimeout"></a>8.3.2.1.9.&nbsp;StateTimeout</h5></div></div><div></div></div><p>
                  The maximum time to wait when waiting for the group state to arrive when a node joins a pre-existing cluster.
               </p><p>The default value is <tt class="literal">5000</tt> milliseconds
               </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.casttimeout"></a>8.3.2.1.10.&nbsp;CastTimeout</h5></div></div><div></div></div><p>
                  The maximum time to wait for a reply casting message synchronously
               </p><p>The default value is <tt class="literal">5000</tt> milliseconds
               </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.statssendperiod"></a>8.3.2.1.11.&nbsp;StatsSendPeriod</h5></div></div><div></div></div><p>
                       When clustering, each node in the cluster will broadcast statistics periodically to inform the other nodes of their queues and the number of
                       messages in them. This data is then used by the message redistribution policy to redistribute messages if necessary.
                       This value represents the number of milliseconds between statistics broadcasts.
              </p><p>
                       The default value is <tt class="literal">10000</tt> milliseconds
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.syncchannelconfig"></a>8.3.2.1.12.&nbsp;SyncChannelConfig</h5></div></div><div></div></div><p>
                    JBoss Messaging uses JGroups for all group management. This contains the JGroups stack configuration for the synchronous channel.
              </p><p>The synchronous channel is used for sending request/reeciving responses from other nodes in the cluster</p><p>
               The details of the JGroups configuration won't be discussed here since it is standard JGroups configuration.
                       Detailed information on JGroups can be found in JGroups release documentation or on-line at
                       <a href="http://www.jgroups.org" target="_top">http://www.jgroups.org</a> or
                 <a href="http://wiki.jboss.org/wiki/Wiki.jsp?page=JGroups" target="_top">http://wiki.jboss.org/wiki/Wiki.jsp?page=JGroups</a>
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.asyncchannelconfig"></a>8.3.2.1.13.&nbsp;AsyncChannelConfig</h5></div></div><div></div></div><p>
                    JBoss Messaging uses JGroups for all group management. This contains the JGroups stack configuration for the asynchronous channel.
              </p><p>The asynchronous channel is used for sending sending/receiving messages from other nodes in the cluster</p><p>
               The details of the JGroups configuration won't be discussed here since it is standard JGroups configuration.
                       Detailed information on JGroups can be found in JGroups release documentation or on-line at
                       <a href="http://www.jgroups.org" target="_top">http://www.jgroups.org</a> or
                 <a href="http://wiki.jboss.org/wiki/Wiki.jsp?page=JGroups" target="_top">http://wiki.jboss.org/wiki/Wiki.jsp?page=JGroups</a>
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.postoffice.clustered.attributes.threadpoolsize"></a>8.3.2.1.14.&nbsp;ThreadPoolSize</h5></div></div><div></div></div><p>
                    The post office uses a thread pool for dispatching requests/handling responses from the cluster. This attribute represents the maximum size of
                    that pool
              </p><p>The default value of this is <tt class="literal">50</tt> threads</p></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="conf.persistencemanager"></a>8.4.&nbsp;Configuring the Persistence Manager</h2></div></div><div></div></div><p>It is the job of the persistence manager to manage all message related persistence.
    </p><p>
       JBoss Messaging ships with a JDBC Persistence Manager used for handling persistence of
       message data in a relational database accessed via JDBC. The Persistence Manager
       implementation is pluggable (the Persistence Manager is a Messaging server plug-in),
       this making possible to provide other implementations for persisting message data in
       non relational stores, file stores etc.
    </p><p>
        The configuration of "persistent" services is grouped in a
        <tt class="filename">xxx-persistence-service.xml</tt> file, where the actual file prefix is
        usually inferred from its corresponding database JDBC connection string. By default,
        Messaging ships with a <tt class="filename">hsqldb-persistence-service.xml</tt>, which configures
        the Messaging server to use the in-VM Hypersonic database instance that comes by default
        with any JBossAS instance.
     </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
        The default Persistence Manager configuration is works out of the box with Hypersonic,
        however it must be stressed that Hypersonic should not be used in a production environment
        mainly due to its limited support for transaction isolation and its propensity to behave
        erratically under high load.
        </p><p>
           The
           <a href="http://wiki.jboss.org/wiki/Wiki.jsp?page=ConfigJBossMQDB" target="_top">Critique of Hypersonic</a>
           wiki page outlines some of the well-known issues occuring when using this database.
        </p></div><p>
        JBoss Messaging also ships with pre-made Persistence Manager configurations for MySQL,
        Oracle, PostgreSQL, Sybase and MS SQL Server. The example <tt class="filename">mysql-persistence-service.xml</tt>,
        <tt class="filename">oracle-persistence-service.xml</tt>,
        <tt class="filename">postgres-persistence-service.xml</tt> and
        <tt class="filename">sybase-persistence-service.xml</tt> and
        <tt class="filename">mssql-persistence-service.xml</tt> configuration files are available
        in the <tt class="filename">examples/config</tt> directory of the release bundle.
     </p><p>
        Users are encouraged to contribute their own configuration files where we will thoroughly test them before certifying them for suppported use
        with JBoss Messaging. The JDBC Persistence Manager has been designed
        to use standard SQL for the DML so writing a JDBC Persistence Manager configuration for another
        database is usually only a fairly simple matter of changing DDL in the configuration
        which is likely to be different for different databases.
     </p><p>
        The default Hypersonic persistence configuration file is listed below:
     </p><pre class="programlisting">

      &lt;server&gt;

         &lt;mbean code="org.jboss.messaging.core.plugin.JDBCPersistenceManagerService"
            name="jboss.messaging:service=PersistenceManager"
            xmbean-dd="xmdesc/JDBCPersistenceManager-xmbean.xml"&gt;
            &lt;depends&gt;jboss.jca:service=DataSourceBinding,name=DefaultDS&lt;/depends&gt;
            &lt;depends optional-attribute-name="TransactionManager"&gt;jboss:service=TransactionManager&lt;/depends&gt;
            &lt;attribute name="DataSource"&gt;java:/DefaultDS&lt;/attribute&gt;
            &lt;attribute name="CreateTablesOnStartup"&gt;true&lt;/attribute&gt;
            &lt;attribute name="UsingBatchUpdates"&gt;false&lt;/attribute&gt;
            &lt;attribute name="MaxParams"&gt;500&lt;/attribute&gt;
         &lt;/mbean&gt;

         &lt;mbean code="org.jboss.messaging.core.plugin.DefaultPostOfficeService"
            name="jboss.messaging:service=PostOffice"
            xmbean-dd="xmdesc/DefaultPostOffice-xmbean.xml"&gt;
            &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
            &lt;depends&gt;jboss.jca:service=DataSourceBinding,name=DefaultDS&lt;/depends&gt;
            &lt;depends optional-attribute-name="TransactionManager"&gt;jboss:service=TransactionManager&lt;/depends&gt;
            &lt;attribute name="PostOfficeName"&gt;JMS&lt;/attribute&gt;
            &lt;attribute name="DataSource"&gt;java:/DefaultDS&lt;/attribute&gt;
            &lt;attribute name="CreateTablesOnStartup"&gt;true&lt;/attribute&gt;
         &lt;/mbean&gt;

         &lt;mbean code="org.jboss.jms.server.plugin.JDBCJMSUserManagerService"
            name="jboss.messaging:service=JMSUserManager"
            xmbean-dd="xmdesc/JMSUserManager-xmbean.xml"&gt;
            &lt;depends&gt;jboss.jca:service=DataSourceBinding,name=DefaultDS&lt;/depends&gt;
            &lt;depends optional-attribute-name="TransactionManager"&gt;jboss:service=TransactionManager&lt;/depends&gt;
            &lt;attribute name="DataSource"&gt;java:/DefaultDS&lt;/attribute&gt;
            &lt;attribute name="CreateTablesOnStartup"&gt;true&lt;/attribute&gt;
            &lt;attribute name="SqlProperties"&gt;&lt;![CDATA[
      POPULATE.TABLES.1=INSERT INTO JBM_USER (USER_ID,PASSWD,CLIENTID) VALUES ('dilbert','dogbert','dilbert-id')
            ]]&gt;&lt;/attribute&gt;
         &lt;/mbean&gt;

      &lt;/server&gt;

   </pre><p>
        An example of a Persistence Manager configuration for a MySQL database follows:
     </p><pre class="programlisting">

   &lt;server&gt;

      &lt;mbean code="org.jboss.messaging.core.plugin.JDBCPersistenceManagerService"
            name="jboss.messaging:service=PersistenceManager"
            xmbean-dd="xmdesc/JDBCPersistenceManager-xmbean.xml"&gt;
            &lt;depends&gt;jboss.jca:service=DataSourceBinding,name=DefaultDS&lt;/depends&gt;
            &lt;depends optional-attribute-name="TransactionManager"&gt;jboss:service=TransactionManager&lt;/depends&gt;
            &lt;attribute name="DataSource"&gt;java:/DefaultDS&lt;/attribute&gt;
            &lt;attribute name="CreateTablesOnStartup"&gt;true&lt;/attribute&gt;
            &lt;attribute name="UsingBatchUpdates"&gt;true&lt;/attribute&gt;
            &lt;attribute name="SqlProperties"&gt;&lt;![CDATA[
      CREATE_MESSAGE_REFERENCE=CREATE TABLE JBM_MSG_REF (CHANNEL_ID BIGINT, MESSAGE_ID BIGINT, TRANSACTION_ID BIGINT, STATE CHAR(1), ORD BIGINT, PAGE_ORD BIGINT, DELIVERY_COUNT INTEGER, SCHED_DELIVERY BIGINT, PRIMARY KEY(CHANNEL_ID, MESSAGE_ID))
      CREATE_IDX_MESSAGE_REF_TX=CREATE INDEX JBM_MSG_REF_TX ON JBM_MSG_REF (TRANSACTION_ID)
      CREATE_IDX_MESSAGE_REF_ORD=CREATE INDEX JBM_MSG_REF_ORD ON JBM_MSG_REF (ORD)
      CREATE_IDX_MESSAGE_REF_PAGE_ORD=CREATE INDEX JBM_MSG_REF_PAGE_ORD ON JBM_MSG_REF (PAGE_ORD)
      CREATE_IDX_MESSAGE_REF_MESSAGE_ID=CREATE INDEX JBM_MSG_REF_MESSAGE_ID ON JBM_MSG_REF (MESSAGE_ID)
      CREATE_IDX_MESSAGE_REF_SCHED_DELIVERY=CREATE INDEX JBM_MSG_REF_SCHED_DELIVERY ON JBM_MSG_REF (SCHED_DELIVERY)
      CREATE_MESSAGE=CREATE TABLE JBM_MSG (MESSAGE_ID BIGINT, RELIABLE CHAR(1), EXPIRATION BIGINT, TIMESTAMP BIGINT, PRIORITY TINYINT, HEADERS MEDIUMBLOB, PAYLOAD LONGBLOB, CHANNEL_COUNT INTEGER, TYPE TINYINT, PRIMARY KEY (MESSAGE_ID))
      CREATE_TRANSACTION=CREATE TABLE JBM_TX (TRANSACTION_ID BIGINT, BRANCH_QUAL VARBINARY(254), FORMAT_ID INTEGER, GLOBAL_TXID VARBINARY(254), PRIMARY KEY (TRANSACTION_ID))
      CREATE_COUNTER=CREATE TABLE JBM_COUNTER (NAME VARCHAR(255), NEXT_ID BIGINT, PRIMARY KEY(NAME))
      INSERT_MESSAGE_REF=INSERT INTO JBM_MSG_REF (CHANNEL_ID, MESSAGE_ID, TRANSACTION_ID, STATE, ORD, PAGE_ORD, DELIVERY_COUNT, SCHED_DELIVERY) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
      DELETE_MESSAGE_REF=DELETE FROM JBM_MSG_REF WHERE MESSAGE_ID=? AND CHANNEL_ID=? AND STATE='C'
      UPDATE_MESSAGE_REF=UPDATE JBM_MSG_REF SET TRANSACTION_ID=?, STATE='-' WHERE MESSAGE_ID=? AND CHANNEL_ID=? AND STATE='C'
      UPDATE_PAGE_ORDER=UPDATE JBM_MSG_REF SET PAGE_ORD = ? WHERE MESSAGE_ID=? AND CHANNEL_ID=?
      COMMIT_MESSAGE_REF1=UPDATE JBM_MSG_REF SET STATE='C', TRANSACTION_ID = NULL WHERE TRANSACTION_ID=? AND STATE='+'
      COMMIT_MESSAGE_REF2=DELETE FROM JBM_MSG_REF WHERE TRANSACTION_ID=? AND STATE='-'
      ROLLBACK_MESSAGE_REF1=DELETE FROM JBM_MSG_REF WHERE TRANSACTION_ID=? AND STATE='+'
      ROLLBACK_MESSAGE_REF2=UPDATE JBM_MSG_REF SET STATE='C', TRANSACTION_ID = NULL WHERE TRANSACTION_ID=? AND STATE='-'
      LOAD_PAGED_REFS=SELECT MESSAGE_ID, DELIVERY_COUNT, PAGE_ORD, SCHED_DELIVERY FROM JBM_MSG_REF WHERE CHANNEL_ID = ? AND PAGE_ORD BETWEEN ? AND ? ORDER BY PAGE_ORD
      LOAD_UNPAGED_REFS=SELECT MESSAGE_ID, DELIVERY_COUNT, SCHED_DELIVERY FROM JBM_MSG_REF WHERE STATE = 'C' AND CHANNEL_ID = ? AND PAGE_ORD IS NULL ORDER BY ORD
      LOAD_REFS=SELECT MESSAGE_ID, DELIVERY_COUNT, SCHED_DELIVERY FROM JBM_MSG_REF WHERE STATE = 'C' AND CHANNEL_ID = ? ORDER BY ORD
      UPDATE_REFS_NOT_PAGED=UPDATE JBM_MSG_REF SET PAGE_ORD = NULL WHERE PAGE_ORD BETWEEN ? AND ? AND CHANNEL_ID=?
      SELECT_MIN_MAX_PAGE_ORD=SELECT MIN(PAGE_ORD), MAX(PAGE_ORD) FROM JBM_MSG_REF WHERE CHANNEL_ID = ?
      SELECT_EXISTS_REF=SELECT MESSAGE_ID FROM JBM_MSG_REF WHERE CHANNEL_ID = ? AND MESSAGE_ID = ?
      SELECT_EXISTS_REF_MESSAGE_ID=SELECT MESSAGE_ID FROM JBM_MSG_REF WHERE MESSAGE_ID = ?
      UPDATE_DELIVERY_COUNT=UPDATE JBM_MSG_REF SET DELIVERY_COUNT = ? WHERE CHANNEL_ID = ? AND MESSAGE_ID = ?
      UPDATE_CHANNEL_ID=UPDATE JBM_MSG_REF SET CHANNEL_ID = ? WHERE CHANNEL_ID = ?
      LOAD_MESSAGES=SELECT MESSAGE_ID, RELIABLE, EXPIRATION, TIMESTAMP, PRIORITY, HEADERS, PAYLOAD, TYPE FROM JBM_MSG
      INSERT_MESSAGE=INSERT INTO JBM_MSG (MESSAGE_ID, RELIABLE, EXPIRATION, TIMESTAMP, PRIORITY, HEADERS, PAYLOAD, CHANNEL_COUNT, TYPE) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
      INC_CHANNEL_COUNT=UPDATE JBM_MSG SET CHANNEL_COUNT = CHANNEL_COUNT + 1 WHERE MESSAGE_ID=?
      DEC_CHANNEL_COUNT=UPDATE JBM_MSG SET CHANNEL_COUNT = CHANNEL_COUNT - 1 WHERE MESSAGE_ID=?
      DELETE_MESSAGE=DELETE FROM JBM_MSG WHERE MESSAGE_ID=? AND CHANNEL_COUNT=0
      MESSAGE_ID_COLUMN=MESSAGE_ID
      MESSAGE_EXISTS=SELECT MESSAGE_ID FROM JBM_MSG WHERE MESSAGE_ID = ? FOR UPDATE
      INSERT_TRANSACTION=INSERT INTO JBM_TX (TRANSACTION_ID, BRANCH_QUAL, FORMAT_ID, GLOBAL_TXID) VALUES(?, ?, ?, ?)
      DELETE_TRANSACTION=DELETE FROM JBM_TX WHERE TRANSACTION_ID = ?
      SELECT_PREPARED_TRANSACTIONS=SELECT TRANSACTION_ID, BRANCH_QUAL, FORMAT_ID, GLOBAL_TXID FROM JBM_TX
      SELECT_MESSAGE_ID_FOR_REF=SELECT MESSAGE_ID, CHANNEL_ID FROM JBM_MSG_REF WHERE TRANSACTION_ID = ? AND STATE = '+' ORDER BY ORD
      SELECT_MESSAGE_ID_FOR_ACK=SELECT MESSAGE_ID, CHANNEL_ID FROM JBM_MSG_REF WHERE TRANSACTION_ID = ? AND STATE = '-' ORDER BY ORD
      UPDATE_COUNTER=UPDATE JBM_COUNTER SET NEXT_ID = ? WHERE NAME=?
      SELECT_COUNTER=SELECT NEXT_ID FROM JBM_COUNTER WHERE NAME=? FOR UPDATE
      INSERT_COUNTER=INSERT INTO JBM_COUNTER (NAME, NEXT_ID) VALUES (?, ?)
      SELECT_ALL_CHANNELS=SELECT DISTINCT(CHANNEL_ID) FROM JBM_MSG_REF
            ]]&gt;&lt;/attribute&gt;
            &lt;attribute name="MaxParams"&gt;500&lt;/attribute&gt;
      &lt;/mbean&gt;

      &lt;mbean code="org.jboss.messaging.core.plugin.DefaultPostOfficeService"
         name="jboss.messaging:service=PostOffice"
         xmbean-dd="xmdesc/DefaultPostOffice-xmbean.xml"&gt;
         &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
         &lt;depends&gt;jboss.jca:service=DataSourceBinding,name=DefaultDS&lt;/depends&gt;
         &lt;depends optional-attribute-name="TransactionManager"&gt;jboss:service=TransactionManager&lt;/depends&gt;
         &lt;attribute name="PostOfficeName"&gt;JMS&lt;/attribute&gt;
         &lt;attribute name="DataSource"&gt;java:/DefaultDS&lt;/attribute&gt;
         &lt;attribute name="CreateTablesOnStartup"&gt;true&lt;/attribute&gt;
         &lt;attribute name="SqlProperties"&gt;&lt;![CDATA[
   CREATE_POSTOFFICE_TABLE=CREATE TABLE JBM_POSTOFFICE (POSTOFFICE_NAME VARCHAR(255), NODE_ID INTEGER, QUEUE_NAME VARCHAR(1023), COND VARCHAR(1023), SELECTOR VARCHAR(1023), CHANNEL_ID BIGINT, CLUSTERED CHAR(1))
   INSERT_BINDING=INSERT INTO JBM_POSTOFFICE (POSTOFFICE_NAME, NODE_ID, QUEUE_NAME, COND, SELECTOR, CHANNEL_ID, CLUSTERED) VALUES (?, ?, ?, ?, ?, ?, ?)
   DELETE_BINDING=DELETE FROM JBM_POSTOFFICE WHERE POSTOFFICE_NAME=? AND NODE_ID=? AND QUEUE_NAME=?
   LOAD_BINDINGS=SELECT NODE_ID, QUEUE_NAME, COND, SELECTOR, CHANNEL_ID, CLUSTERED FROM JBM_POSTOFFICE WHERE POSTOFFICE_NAME  = ?
         ]]&gt;&lt;/attribute&gt;
      &lt;/mbean&gt;

      &lt;mbean code="org.jboss.jms.server.plugin.JDBCJMSUserManagerService"
         name="jboss.messaging:service=JMSUserManager"
         xmbean-dd="xmdesc/JMSUserManager-xmbean.xml"&gt;
         &lt;depends&gt;jboss.jca:service=DataSourceBinding,name=DefaultDS&lt;/depends&gt;
         &lt;depends optional-attribute-name="TransactionManager"&gt;jboss:service=TransactionManager&lt;/depends&gt;
         &lt;attribute name="DataSource"&gt;java:/DefaultDS&lt;/attribute&gt;
         &lt;attribute name="CreateTablesOnStartup"&gt;true&lt;/attribute&gt;
         &lt;attribute name="SqlProperties"&gt;&lt;![CDATA[
   CREATE_USER_TABLE=CREATE TABLE JBM_USER (USER_ID VARCHAR(32) NOT NULL, PASSWD VARCHAR(32) NOT NULL, CLIENTID VARCHAR(128), PRIMARY KEY(USER_ID))
   CREATE_ROLE_TABLE=CREATE TABLE JBM_ROLE (ROLE_ID VARCHAR(32) NOT NULL, USER_ID VARCHAR(32) NOT NULL, PRIMARY KEY(USER_ID, ROLE_ID))
   SELECT_PRECONF_CLIENTID=SELECT CLIENTID FROM JBM_USER WHERE USER_ID=?
   POPULATE.TABLES.1=INSERT INTO JBM_USER (USER_ID,PASSWD,CLIENTID) VALUES ('dilbert','dogbert','dilbert-id')
         ]]&gt;&lt;/attribute&gt;
      &lt;/mbean&gt;

   &lt;/server&gt;

  </pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="conf.persistencemanager.attributes"></a>8.4.1.&nbsp;
        We now discuss the MBean attributes of the PersistenceManager MBean
        </h3></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.persistencemanager.attributes.createtables"></a>8.4.1.1.&nbsp;CreateTablesOnStartup</h4></div></div><div></div></div><p>
              Set this to <tt class="literal">true</tt> if you wish the Persistence Manager to attempt
              to create the tables (and indexes) when it starts. If the tables (or indexes)
              already exist a <tt class="literal">SQLException</tt> will be thrown by the JDBC driver and
              ignored by the Persistence Manager, allowing it to continue.
           </p><p>
              By default the value of <tt class="literal">CreateTablesOnStartup</tt> attribute
              is set to <tt class="literal">true</tt>
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.persistencemanager.attributes.batchupdates"></a>8.4.1.2.&nbsp;UsingBatchUpdates</h4></div></div><div></div></div><p>
              Set this to <tt class="literal">true</tt> if the database supports JDBC batch updates.
              The JDBC Persistence Manager will then group multiple database updates in batches
              to aid performance.
           </p><p>
            By default the value of <tt class="literal">UsingBatchUpdates</tt> attribute
            is set to <tt class="literal">false</tt>
         </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.persistencemanager.attributes.binarystream"></a>8.4.1.3.&nbsp;UsingBinaryStream</h4></div></div><div></div></div><p>
              Set this to <tt class="literal">true</tt> if you want messages to be store and read using a JDBC binary stream rather than using
              getBytes(), setBytes(). Some database has limits on the maximum number of bytes that can be get/set using getBytes()/setBytes().
           </p><p>
            By default the value of <tt class="literal">UsingBinaryStream</tt> attribute
            is set to <tt class="literal">true</tt>
         </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.persistencemanager.attributes.trailingbyte"></a>8.4.1.4.&nbsp;UsingTrailingByte</h4></div></div><div></div></div><p>
              Certain version of Sybase are known to truncate blobs if they have trailing zeros. To prevent this if this attribute is set to
              <tt class="literal">true</tt> then a trailing non zero byte will be added and removed to each blob before and after persistence to prevent
              the database from truncating it. Currently this is only known to be necessary for Sybase.
           </p><p>
            By default the value of <tt class="literal">UsingTrailingByte</tt> attribute
            is set to <tt class="literal">false</tt>
         </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.persistencemanager.attributes.sqlproperties"></a>8.4.1.5.&nbsp;SQLProperties</h4></div></div><div></div></div><p>
              This is where the DDL and DML for the particular database is specified.
              If a particular DDL or DML statement is not overridden, the default Hypersonic
              configuration will be used for that statement.
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.persistencemanager.attributes.maxparams"></a>8.4.1.6.&nbsp;MaxParams</h4></div></div><div></div></div><p>
             When loading messages the persistence manager will generate prepared statements with many parameters. This value tells the persistence
             manager what the absolute maximum number of parameters are allowable per prepared statement.

          </p><p>
           By default the value of <tt class="literal">MaxParams</tt> attribute
           is set to <tt class="literal">100</tt>
        </p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="conf.jmsusermanager"></a>8.5.&nbsp;Configuring the JMS user manager</h2></div></div><div></div></div><p>The JMS user manager handles the mapping of pre-configured client IDs to users and also managers the user and role tables which may or
      may not be used depending on which login module you have configured</p><p>Here is an example JMSUserManager configuration</p><pre class="programlisting">

   &lt;mbean code="org.jboss.jms.server.plugin.JDBCJMSUserManagerService"
      name="jboss.messaging:service=JMSUserManager"
      xmbean-dd="xmdesc/JMSUserManager-xmbean.xml"&gt;
      &lt;depends&gt;jboss.jca:service=DataSourceBinding,name=DefaultDS&lt;/depends&gt;
      &lt;depends optional-attribute-name="TransactionManager"&gt;jboss:service=TransactionManager&lt;/depends&gt;
      &lt;attribute name="DataSource"&gt;java:/DefaultDS&lt;/attribute&gt;
      &lt;attribute name="CreateTablesOnStartup"&gt;true&lt;/attribute&gt;
      &lt;attribute name="SqlProperties"&gt;&lt;![CDATA[
CREATE_USER_TABLE=CREATE TABLE JBM_USER (USER_ID VARCHAR(32) NOT NULL, PASSWD VARCHAR(32) NOT NULL, CLIENTID VARCHAR(128), PRIMARY KEY(USER_ID))
CREATE_ROLE_TABLE=CREATE TABLE JBM_ROLE (ROLE_ID VARCHAR(32) NOT NULL, USER_ID VARCHAR(32) NOT NULL, PRIMARY KEY(USER_ID, ROLE_ID))
SELECT_PRECONF_CLIENTID=SELECT CLIENTID FROM JBM_USER WHERE USER_ID=?
POPULATE.TABLES.1=INSERT INTO JBM_USER (USER_ID,PASSWD,CLIENTID) VALUES ('dilbert','dogbert','dilbert-id')
      ]]&gt;&lt;/attribute&gt;
   &lt;/mbean&gt;

      </pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="conf.jmsusermanager.attributes"></a>8.5.1.&nbsp;
        We now discuss the MBean attributes of the PersistenceManager MBean
        </h3></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.jmsusermanager.attributes.createtables"></a>8.5.1.1.&nbsp;CreateTablesOnStartup</h4></div></div><div></div></div><p>
              Set this to <tt class="literal">true</tt> if you wish the JMS user manager to attempt
              to create the tables (and indexes) when it starts. If the tables (or indexes)
              already exist a <tt class="literal">SQLException</tt> will be thrown by the JDBC driver and
              ignored by the Persistence Manager, allowing it to continue.
           </p><p>
              By default the value of <tt class="literal">CreateTablesOnStartup</tt> attribute
              is set to <tt class="literal">true</tt>
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.jmsusermanager.attributes.batchupdates"></a>8.5.1.2.&nbsp;UsingBatchUpdates</h4></div></div><div></div></div><p>
              Set this to <tt class="literal">true</tt> if the database supports JDBC batch updates.
              The JDBC Persistence Manager will then group multiple database updates in batches
              to aid performance.
           </p><p>
            By default the value of <tt class="literal">UsingBatchUpdates</tt> attribute
            is set to <tt class="literal">false</tt>
         </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.jmsusermanager.attributes.sqlproperties"></a>8.5.1.3.&nbsp;SQLProperties</h4></div></div><div></div></div><p>
              This is where the DDL and DML for the particular database is specified.
              If a particular DDL or DML statement is not overridden, the default Hypersonic
              configuration will be used for that statement.
           </p><p>
           Default user and role data can also be specified here. Any data to be inserted must be specified with property names starting with
           <tt class="literal">POPULATE.TABLES</tt> as in the above example.
           </p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="conf.destination"></a>8.6.&nbsp;Configuring Destinations</h2></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="conf.preconf.destinations"></a>8.6.1.&nbsp;Pre-configured destinations</h3></div></div><div></div></div><p>
           JBoss Messaging  ships with a default set of pre-configured destinations that will be
           deployed during the server start up. The file that contains configuration for these
           destinations is <tt class="filename">destinations-service.xml</tt>. A section of
           this file is listed below:
        </p><pre class="programlisting">
   &lt;!--
      The Default Dead Letter Queue. This destination is a dependency of an EJB MDB container.
   --&gt;

   &lt;mbean code="org.jboss.jms.server.destination.QueueService"
      name="jboss.messaging.destination:service=Queue,name=DLQ"
      xmbean-dd="xmdesc/Queue-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
   &lt;/mbean&gt;


   &lt;mbean code="org.jboss.jms.server.destination.TopicService"
      name="jboss.messaging.destination:service=Topic,name=testTopic"
      xmbean-dd="xmdesc/Topic-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
      &lt;attribute name="SecurityConfig"&gt;
         &lt;security&gt;
            &lt;role name="guest" read="true" write="true"/&gt;
            &lt;role name="publisher" read="true" write="true" create="false"/&gt;
            &lt;role name="durpublisher" read="true" write="true" create="true"/&gt;
         &lt;/security&gt;
      &lt;/attribute&gt;
   &lt;/mbean&gt;

   &lt;mbean code="org.jboss.jms.server.destination.TopicService"
      name="jboss.messaging.destination:service=Topic,name=securedTopic"
      xmbean-dd="xmdesc/Topic-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
      &lt;attribute name="SecurityConfig"&gt;
         &lt;security&gt;
            &lt;role name="publisher" read="true" write="true" create="false"/&gt;
         &lt;/security&gt;
      &lt;/attribute&gt;
   &lt;/mbean&gt;


   &lt;mbean code="org.jboss.jms.server.destination.QueueService"
      name="jboss.messaging.destination:service=Queue,name=testQueue"
      xmbean-dd="xmdesc/Queue-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
      &lt;attribute name="SecurityConfig"&gt;
         &lt;security&gt;
            &lt;role name="guest" read="true" write="true"/&gt;
            &lt;role name="publisher" read="true" write="true" create="false"/&gt;
            &lt;role name="noacc" read="false" write="false" create="false"/&gt;
         &lt;/security&gt;
      &lt;/attribute&gt;
   &lt;/mbean&gt;

   &lt;mbean code="org.jboss.jms.server.destination.QueueService"
      name="jboss.messaging.destination:service=Queue,name=A"
      xmbean-dd="xmdesc/Queue-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
   &lt;/mbean&gt;


   &lt;!-- It's possible for indiviual queues and topics to use a specific queue for
   an expiry or DLQ --&gt;

   &lt;mbean code="org.jboss.jms.server.destination.QueueService"
      name="jboss.messaging.destination:service=Queue,name=PrivateDLQ"
      xmbean-dd="xmdesc/Queue-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
   &lt;/mbean&gt;

   &lt;mbean code="org.jboss.jms.server.destination.QueueService"
      name="jboss.messaging.destination:service=Queue,name=PrivateExpiryQueue"
      xmbean-dd="xmdesc/Queue-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
   &lt;/mbean&gt;

   &lt;mbean code="org.jboss.jms.server.destination.QueueService"
      name="jboss.messaging.destination:service=Queue,name=QueueWithOwnDLQAndExpiryQueue"
      xmbean-dd="xmdesc/Queue-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
      &lt;attribute name="DLQ"&gt;jboss.messaging.destination:service=Queue,name=PrivateDLQ&lt;/attribute&gt;
      &lt;attribute name="ExpiryQueue"&gt;jboss.messaging.destination:service=Queue,name=PrivateExpiryQueue&lt;/attribute&gt;
   &lt;/mbean&gt;

   &lt;mbean code="org.jboss.jms.server.destination.TopicService"
      name="jboss.messaging.destination:service=Topic,name=TopicWithOwnDLQAndExpiryQueue"
      xmbean-dd="xmdesc/Topic-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
      &lt;attribute name="DLQ"&gt;jboss.messaging.destination:service=Queue,name=PrivateDLQ&lt;/attribute&gt;
      &lt;attribute name="ExpiryQueue"&gt;jboss.messaging.destination:service=Queue,name=PrivateExpiryQueue&lt;/attribute&gt;
   &lt;/mbean&gt;


   &lt;mbean code="org.jboss.jms.server.destination.TopicService"
      name="jboss.messaging.destination:service=Topic,name=TopicWithOwnRedeliveryDelay"
      xmbean-dd="xmdesc/Topic-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
      &lt;attribute name="RedeliveryDelay"&gt;5000&lt;/attribute&gt;
   &lt;/mbean&gt;


   &lt;mbean code="org.jboss.jms.server.destination.TopicService"
      name="jboss.messaging.destination:service=Topic,name=testDistributedTopic"
      xmbean-dd="xmdesc/Topic-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
      &lt;attribute name="Clustered"&gt;true&lt;/attribute&gt;
   &lt;/mbean&gt;
....
        </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="conf.destination.queue"></a>8.6.2.&nbsp;Configuring queues</h3></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.destination.queue.attributes"></a>8.6.2.1.&nbsp;
            We now discuss the MBean attributes of the Queue MBean
            </h4></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.name"></a>8.6.2.1.1.&nbsp;Name</h5></div></div><div></div></div><p>The name of the queue</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.jndiName"></a>8.6.2.1.2.&nbsp;JNDIName</h5></div></div><div></div></div><p>The JNDI name where the queue is bound</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.dlq"></a>8.6.2.1.3.&nbsp;DLQ</h5></div></div><div></div></div><p>The DLQ used for this queue. Overrides any value set on the ServerPeer config</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.expiryqueue"></a>8.6.2.1.4.&nbsp;ExpiryQueue</h5></div></div><div></div></div><p>The Expiry queue used for this queue. Overrides any value set on the ServerPeer config</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.redeliverydelay"></a>8.6.2.1.5.&nbsp;RedeliveryDelay</h5></div></div><div></div></div><p>The redlivery delay to be used for this queue. Overrides any value set on the ServerPeer config</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.security"></a>8.6.2.1.6.&nbsp;Destination Security Configuration</h5></div></div><div></div></div><p>
                    <tt class="literal">SecurityConfig</tt> - allows you to determine which roles are allowed
                    to read, write and create on the destination. It has exactly the same syntax and
                    semantics as the security configuration in JBossMQ destinations.
                 </p><p>
                    The <tt class="literal">SecurityConfig</tt> element should contain one
                    <tt class="literal">&lt;security&gt;</tt> element. The <tt class="literal">&lt;security&gt;</tt>
                    element can contain multiple <tt class="literal">&lt;role&gt;</tt> elements.
                    Each <tt class="literal">&lt;role&gt;</tt> element defines the access for that
                    particular role.
                 </p><p>
                    If the <tt class="literal">read</tt> attribute is <tt class="literal">true</tt> then that role
                    will be able to read (create consumers, receive messaages or browse) this destination.
                 </p><p>
                    If the <tt class="literal">write</tt> attribute is <tt class="literal">true</tt> then that role
                    will be able to write (create producers or send messages) to this destination.
                 </p><p>
                    If the <tt class="literal">create</tt> attribute is <tt class="literal">true</tt> then that role
                    will be able to create durable subscriptions on this destination.
                 </p><p>
                    Note that the security configuration for a destination is optional. If a
                    <tt class="literal">SecurityConfig</tt> element is not specifed then the default
                    security configuration from the Server Peer will be used.
                 </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.paging"></a>8.6.2.1.7.&nbsp;Destination paging parameters</h5></div></div><div></div></div><p>
                 'Pageable Channels' are a sophisticated new feature available in JBoss Messaging.
              </p><p>
                 If your application needs to support very large queues or subscriptions containing
                 potentially millions of messages, then it's not possible to store them all in
                 memory at once.
              </p><p>
                 JBoss Messaging solves this problem but letting you specify the
                 maximum number of messages that can be stored in memory at any one time,
                 on a queue-by-queue, or topic-by-topic basis. JBoss Messaging then pages messages
                 to and from storage transparently in blocks, allowing queues and subscriptions to
                 grow to very large sizes without any performance degradation as channel size increases.
              </p><p>
                 This has been tested with in excess of 10 million 2K messages on very basic hardware
                 and has the potential to scale to much larger number of messages.
              </p><p>
                 The individual parameters are:
              </p><p>
                 <tt class="literal">FullSize</tt> - this is the maximum number of messages held by the
                 queue or topic subscriptions in memory at any one time. The actual queue or
                 subscription can hold many more messages than this but these are paged to and
                 from storage as necessary as messages are added or consumed.
              </p><p>
                 <tt class="literal">PageSize</tt> - When loading messages from the queue or subscrition
                 this is the maximum number of messages to pre-load in one operation.
              </p><p>
                 <tt class="literal">DownCacheSize</tt> - When paging messages to storage from the queue
                 they first go into a "Down Cache" before being written to storage. This enables the
                 write to occur as a single operation thus aiding performance. This setting determines
                 the max number of messages that the Down Cache will hold before they are flushed
                 to storage.
              </p><p>
                 If no values for <tt class="literal">FullSize</tt>, <tt class="literal">PageSize</tt>,
                 or <tt class="literal">DownCacheSize</tt> are specified they will default to values
                 75000, 2000, 2000 respectively.
              </p><p>
                 If you want to specify the paging parameters used for temporary queues then you need to specify them
                 on the appropriate connection factory.
                 See connection factory configuration for details.
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.createdprogrammatically"></a>8.6.2.1.8.&nbsp;CreatedProgrammatically</h5></div></div><div></div></div><p>
                 Returns <tt class="literal">true</tt> if the queue was created programmatically
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.messagecount"></a>8.6.2.1.9.&nbsp;MessageCount</h5></div></div><div></div></div><p>
                 Returns the total number of messages in the queue = number not being delivered + number being delivered + number being scheduled
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.scheduledmessagecount"></a>8.6.2.1.10.&nbsp;ScheduledMessageCount</h5></div></div><div></div></div><p>
                 Returns the  number of scheduled messages in the queue. This is the number of messages scheduled to be delivered at a later date.
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.maxsize"></a>8.6.2.1.11.&nbsp;MaxSize</h5></div></div><div></div></div><p>
                 A maximum size (in number of messages) can be specified for a queue. Any messages that arrive beyond this point will be dropped. The default is
                 <tt class="literal">-1</tt> which is unbounded.
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.clustered"></a>8.6.2.1.12.&nbsp;Clustered</h5></div></div><div></div></div><p>
                 Clustered destinations must have this set to <tt class="literal">true</tt>
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.messagecounter"></a>8.6.2.1.13.&nbsp;MessageCounter</h5></div></div><div></div></div><p>
                 Each queue maintains a message counter.
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.messagecounterstats"></a>8.6.2.1.14.&nbsp;MessageCounterStatistics</h5></div></div><div></div></div><p>
                 The statistics for the message counter
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.messagecounterhistorydaylimit"></a>8.6.2.1.15.&nbsp;MessageCounterHistoryDayLimit</h5></div></div><div></div></div><p>
                 The maximum number of days to hold message counter history for. Overrides any value set on the ServerPeer.
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.attributes.consumercount"></a>8.6.2.1.16.&nbsp;ConsumerCount</h5></div></div><div></div></div><p>
                 The number of consumers currently consuming from the queue.
              </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.destination.queue.operations"></a>8.6.2.2.&nbsp;
             We now discuss the MBean operations of the Queue MBean
         </h4></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.operations.removeallmessages"></a>8.6.2.2.1.&nbsp;RemoveAllMessages</h5></div></div><div></div></div><p>
                Remove (and delete) all messages from the queue.
                </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>Use this with caution. It will permanently delete all messages from the queue</div><p>
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.operations.listallmessages"></a>8.6.2.2.2.&nbsp;ListAllMessages</h5></div></div><div></div></div><p>
                List all messages currently in the queue
             </p><p>There are two overloaded versions of this operation: One takes a JMS selector as an argument, the other does not. By using the selector
             you can retrieve a subset of the messages in the queue that match the criteria</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.operations.listdurablemessages"></a>8.6.2.2.3.&nbsp;ListDurableMessages</h5></div></div><div></div></div><p>
                As listAllMessages but only lists the durable messages
             </p><p>There are two overloaded versions of this operation: One takes a JMS selector as an argument, the other does not. By using the selector
             you can retrieve a subset of the messages in the queue that match the criteria</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.operations.listnondurablemessages"></a>8.6.2.2.4.&nbsp;ListNonDurableMessages</h5></div></div><div></div></div><p>
                As listAllMessages but only lists the non durable messages
             </p><p>There are two overloaded versions of this operation: One takes a JMS selector as an argument, the other does not. By using the selector
             you can retrieve a subset of the messages in the queue that match the criteria</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.operations.resetmessagecounter"></a>8.6.2.2.5.&nbsp;ResetMessageCounter</h5></div></div><div></div></div><p>
                Resets the message counter to zero.
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.operations.resetmessagecounterhistory"></a>8.6.2.2.6.&nbsp;ResetMessageCounterHistory</h5></div></div><div></div></div><p>
                Resets the message counter history.
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.operations.listmessagecounterashtml"></a>8.6.2.2.7.&nbsp;ListMessageCounterAsHTML</h5></div></div><div></div></div><p>
                Lists the message counter in an easy to display HTML format
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.queue.operations.listmessagecounterhistoryashtml"></a>8.6.2.2.8.&nbsp;ListMessageCounterHistoryAsHTML</h5></div></div><div></div></div><p>
                Lists the message counter history in an easy to display HTML format
             </p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="conf.destination.topics"></a>8.6.3.&nbsp;Configuring topics</h3></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.destination.topic.attributes"></a>8.6.3.1.&nbsp;
            We now discuss the MBean attributes of the Topic MBean
            </h4></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.name"></a>8.6.3.1.1.&nbsp;Name</h5></div></div><div></div></div><p>The name of the topic</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.jndiName"></a>8.6.3.1.2.&nbsp;JNDIName</h5></div></div><div></div></div><p>The JNDI name where the topic is bound</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.dlq"></a>8.6.3.1.3.&nbsp;DLQ</h5></div></div><div></div></div><p>The DLQ used for this topic. Overrides any value set on the ServerPeer config</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.expiryqueue"></a>8.6.3.1.4.&nbsp;ExpiryQueue</h5></div></div><div></div></div><p>The Expiry queue used for this topic. Overrides any value set on the ServerPeer config</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.redeliverydelay"></a>8.6.3.1.5.&nbsp;RedeliveryDelay</h5></div></div><div></div></div><p>The redelivery delay to be used for this topic. Overrides any value set on the ServerPeer config</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.security"></a>8.6.3.1.6.&nbsp;Destination Security Configuration</h5></div></div><div></div></div><p>
                    <tt class="literal">SecurityConfig</tt> - allows you to determine which roles are allowed
                    to read, write and create on the destination. It has exactly the same syntax and
                    semantics as the security configuration in JBossMQ destinations.
                 </p><p>
                    The <tt class="literal">SecurityConfig</tt> element should contain one
                    <tt class="literal">&lt;security&gt;</tt> element. The <tt class="literal">&lt;security&gt;</tt>
                    element can contain multiple <tt class="literal">&lt;role&gt;</tt> elements.
                    Each <tt class="literal">&lt;role&gt;</tt> element defines the access for that
                    particular role.
                 </p><p>
                    If the <tt class="literal">read</tt> attribute is <tt class="literal">true</tt> then that role
                    will be able to read (create consumers, receive messaages or browse) this destination.
                 </p><p>
                    If the <tt class="literal">write</tt> attribute is <tt class="literal">true</tt> then that role
                    will be able to write (create producers or send messages) to this destination.
                 </p><p>
                    If the <tt class="literal">create</tt> attribute is <tt class="literal">true</tt> then that role
                    will be able to create durable subscriptions on this destination.
                 </p><p>
                    Note that the security configuration for a destination is optional. If a
                    <tt class="literal">SecurityConfig</tt> element is not specifed then the default
                    security configuration from the Server Peer will be used.
                 </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.paging"></a>8.6.3.1.7.&nbsp;Destination paging parameters</h5></div></div><div></div></div><p>
                 'Pageable Channels' are a sophisticated new feature available in JBoss Messaging.
              </p><p>
                 If your application needs to support very large queues or subscriptions containing
                 potentially millions of messages, then it's not possible to store them all in
                 memory at once.
              </p><p>
                 JBoss Messaging solves this problem but letting you specify the
                 maximum number of messages that can be stored in memory at any one time,
                 on a queue-by-queue, or topic-by-topic basis. JBoss Messaging then pages messages
                 to and from storage transparently in blocks, allowing queues and subscriptions to
                 grow to very large sizes without any performance degradation as channel size increases.
              </p><p>
                 This has been tested with in excess of 10 million 2K messages on very basic hardware
                 and has the potential to scale to much larger number of messages.
              </p><p>
                 The individual parameters are:
              </p><p>
                 <tt class="literal">FullSize</tt> - this is the maximum number of messages held by the
                 queue or topic subscriptions in memory at any one time. The actual queue or
                 subscription can hold many more messages than this but these are paged to and
                 from storage as necessary as messages are added or consumed.
              </p><p>
                 <tt class="literal">PageSize</tt> - When loading messages from the queue or subscrition
                 this is the maximum number of messages to pre-load in one operation.
              </p><p>
                 <tt class="literal">DownCacheSize</tt> - When paging messages to storage from the queue
                 they first go into a "Down Cache" before being written to storage. This enables the
                 write to occur as a single operation thus aiding performance. This setting determines
                 the max number of messages that the Down Cache will hold before they are flushed
                 to storage.
              </p><p>
                 If no values for <tt class="literal">FullSize</tt>, <tt class="literal">PageSize</tt>,
                 or <tt class="literal">DownCacheSize</tt> are specified they will default to values
                 75000, 2000, 2000 respectively.
              </p><p>
                 If you want to specify the paging parameters used for temporary queues then you need to specify them
                 on the appropriate connection factory.
                 See connection factory configuration for details.
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.createdprogrammatically"></a>8.6.3.1.8.&nbsp;CreatedProgrammatically</h5></div></div><div></div></div><p>
                 Returns <tt class="literal">true</tt> if the topic was created programmatically
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.maxsize"></a>8.6.3.1.9.&nbsp;MaxSize</h5></div></div><div></div></div><p>
                 A maximum size (in number of messages) can be specified for a topic subscription. Any messages that arrive beyond this point will be dropped. The default is
                 <tt class="literal">-1</tt> which is unbounded.
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.clustered"></a>8.6.3.1.10.&nbsp;Clustered</h5></div></div><div></div></div><p>
                 Clustered destinations must have this set to <tt class="literal">true</tt>
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.messagecounterhistorydaylimit"></a>8.6.3.1.11.&nbsp;MessageCounterHistoryDayLimit</h5></div></div><div></div></div><p>
                 The maximum number of days to hold message counter history for. Overrides any value set on the ServerPeer.
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.messagecounters"></a>8.6.3.1.12.&nbsp;MessageCounters</h5></div></div><div></div></div><p>
                 Return a list of the message counters for the subscriptions of this topic.
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.allmessagecount"></a>8.6.3.1.13.&nbsp;AllMessageCount</h5></div></div><div></div></div><p>
                 Return the total number of messages in all subscriptions of this topic.
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.durablemessagecount"></a>8.6.3.1.14.&nbsp;DurableMessageCount</h5></div></div><div></div></div><p>
                 Return the total number of durable messages in all subscriptions of this topic.
              </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.nondurablemessagecount"></a>8.6.3.1.15.&nbsp;NonDurableMessageCount</h5></div></div><div></div></div><p>
               Return the total number of non durable messages in all subscriptions of this topic.
            </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.allsubscriptionscount"></a>8.6.3.1.16.&nbsp;AllSubscriptionsCount</h5></div></div><div></div></div><p>
               The count of all subscriptions on this topic
            </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributes.durablesubscriptionscount"></a>8.6.3.1.17.&nbsp;DurableSubscriptionsCount</h5></div></div><div></div></div><p>
               The count of all durable subscriptions on this topic
            </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.attributesnon.durablesubscriptionscount"></a>8.6.3.1.18.&nbsp;NonDurableSubscriptionsCount</h5></div></div><div></div></div><p>
               The count of all non durable subscriptions on this topic
            </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.destination.topic.operations"></a>8.6.3.2.&nbsp;
             We now discuss the MBean operations of the Topic MBean
         </h4></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.operations.removeallmessages"></a>8.6.3.2.1.&nbsp;RemoveAllMessages</h5></div></div><div></div></div><p>
                Remove (and delete) all messages from the subscriptions of this topic.
                </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>Use this with caution. It will permanently delete all messages from the topic</div><p>
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.operations.listallsubscriptions"></a>8.6.3.2.2.&nbsp;ListAllSubscriptions</h5></div></div><div></div></div><p>
                List all subscriptions of this topic
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.operations.listdurablesubscriptions"></a>8.6.3.2.3.&nbsp;ListDurableSubscriptions</h5></div></div><div></div></div><p>
                List all durable subscriptions of this topic
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.operations.listnondurablesubscriptions"></a>8.6.3.2.4.&nbsp;ListNonDurableSubscriptions</h5></div></div><div></div></div><p>
                List all non durable subscriptions of this topic
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.operations.listallsubscriptionsashtml"></a>8.6.3.2.5.&nbsp;ListAllSubscriptionsAsHTML</h5></div></div><div></div></div><p>
                List all subscriptions of this topic in an easy to display HTML format
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.operations.listdurablesubscriptionsashtml"></a>8.6.3.2.6.&nbsp;ListDurableSubscriptionsAsHTML</h5></div></div><div></div></div><p>
                List all durable subscriptions of this topic in an easy to display HTML format
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.operations.listnondurablesubscriptionsashtml"></a>8.6.3.2.7.&nbsp;ListNonDurableSubscriptionsAsHTML</h5></div></div><div></div></div><p>
                List all non durable subscriptions of this topic in an easy to display HTML format
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.operations.listallmessages"></a>8.6.3.2.8.&nbsp;ListAllMessages</h5></div></div><div></div></div><p>
                Lists all messages for the specified subscription.
             </p><p> There are two overloaded versions of this operation. One that takes a selector and one that does not.
             By specifyingthe selector you can limit the messages returned.
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.operations.listnondurablemessages"></a>8.6.3.2.9.&nbsp;ListNonDurableMessages</h5></div></div><div></div></div><p>
                Lists all non durable messages for the specified subscription.
             </p><p> There are two overloaded versions of this operation. One that takes a selector and one that does not.
             By specifyingthe selector you can limit the messages returned.
             </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="conf.destination.topic.operations.listdurablemessages"></a>8.6.3.2.10.&nbsp;ListDurableMessages</h5></div></div><div></div></div><p>
                Lists all durable messages for the specified subscription.
             </p><p> There are two overloaded versions of this operation. One that takes a selector and one that does not.
             By specifyingthe selector you can limit the messages returned.
             </p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="conf.destination.new"></a>8.6.4.&nbsp;Deploying a new destination</h3></div></div><div></div></div><p>
           For a JBoss 4.0.x installation, JBoss Messaging is deployed in its own class
           loading domain. Because of that you need to deploy a new destinations to use
           with JBoss Messaging within the same class loading domain.
       </p><p>
           To deploy a new destination, create a new deployment descriptor named
           <tt class="filename">myqueue-service.xml</tt> (or anything else that ends in
           <tt class="literal">-service.xml</tt>) and copy it to the JBoss instance deployment
           directory <tt class="filename">$JBOSS_HOME/server/messaging/deploy</tt>.
        </p><p>
           An example of a scoped destination deployment descriptor is listed below:
        </p><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;server&gt;
   &lt;loader-repository&gt;jboss.messaging:loader=ScopedLoaderRepository
   &lt;loader-repository-config&gt;java2ParentDelegation=false&lt;/loader-repository-config&gt;
   &lt;/loader-repository&gt;
   &lt;mbean
      code="org.jboss.jms.server.destination.Queue"
     name="jboss.messaging.destination:service=Queue,name=testQueue"
     xmbean-dd="xmdesc/Queue-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;
         jboss.messaging:service=ServerPeer
      &lt;/depends&gt;
      &lt;attribute name="SecurityConfig"&gt;
         &lt;security&gt;
            &lt;role name="guest" read="true"write="true"/&gt;
            &lt;role name="publisher" read="true" write="true" create="false"/&gt;
            &lt;role name="noacc" read="false" write="false" create="false"/&gt;
          &lt;/security&gt;
      &lt;/attribute&gt;
      &lt;attribute name="fullSize"&gt;75000&lt;/attribute&gt;
      &lt;attribute name="pageSize"&gt;2000&lt;/attribute&gt;
      &lt;attribute name="downCacheSize"&gt;2000&lt;/attribute&gt;
   &lt;/mbean&gt;
&lt;/server&gt;
        </pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="conf.connections"></a>8.7.&nbsp;Configuring Connection Factories</h2></div></div><div></div></div><p>
       With the default configuration JBoss Messaging binds just one connection factory in
       JNDI at start-up. This connection factory has no client ID and is bound into the
       following JNDI contexts:
       <tt class="literal">/ConnectionFactory, /XAConnectionFactory, java:/ConnectionFactory, java:/XAConnectionFactory</tt>
    </p><p>
       You may want to configure additional connection factories, for instance if you want to provide
       a default client id for a connection factory, or if you want to bind it in different places
       in JNDI, or if you want different connection factories to use different transports. Deploying
       a new connection factory is equivalent with adding a new ConnectionFactory MBean
       configuration to <tt class="filename">connection-factories-service.xml</tt>.
    </p><p>
        It is also possible to create an entirely
        new service deployment descriptor <tt class="filename">xxx-service.xml</tt> altogether and
        deploy it in <tt class="filename">$JBOSS_HOME/server/messaging/deploy</tt>.
    </p><p>
    Connection factories can either be clustered or non clustered.
    Clustered connection factories create subsequent connections on different nodes of the cluster according to the load balancing policy.
    The default load balancing policy is round robin.
    </p><p>
       An example connection factory configuration is presented below:
     </p><pre class="programlisting">

&lt;server&gt;
   &lt;loader-repository&gt;
      jboss.messaging:loader=ScopedLoaderRepository
         &lt;loader-repository-config&gt;
            java2ParentDelegation=false
         &lt;/loader-repository-config&gt;
   &lt;/loader-repository&gt;
   &lt;mbean
      code="org.jboss.jms.server.connectionfactory.ConnectionFactory"
      name="jboss.messaging.destination:service=ConnectionFactory"
      xmbean-dd="xmdesc/ConnectionFactory-xmbean.xml"&gt;
      &lt;constructor&gt;
         &lt;arg type="java.lang.String" value="myClientID"/&gt;
      &lt;/constructor&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;
         jboss.messaging:service=ServerPeer
      &lt;/depends&gt;
      &lt;depends optional-attribute-name="Connector"&gt;
         jboss.messaging:service=Connector,transport=socket
      &lt;/depends&gt;
      &lt;attribute name="PrefetchSize"&gt;10&lt;/attribute&gt;
      &lt;attribute name="DefaultTempQueueFullSize"&gt;1000&lt;/attribute&gt;
      &lt;attribute name="DefaultTempQueuePageSize"&gt;50&lt;/attribute&gt;
      &lt;attribute name="DefaultTempQueueDownCacheSize"&gt;50&lt;/attribute&gt;
      &lt;attribute name="JNDIBindings"&gt;
         &lt;bindings&gt;
            &lt;binding&gt;/MyConnectionFactory1&lt;/binding&gt;
            &lt;binding&gt;/factories/cf1&lt;/binding&gt;&gt;
         &lt;/bindings&gt;
      &lt;/attribute&gt;
   &lt;/mbean&gt;
&lt;/server&gt;

    </pre><p>
        The above example would create a connection factory with pre-configured client ID
        <tt class="literal">myClientID</tt> and bind the connection factory in two places in
        the JNDI tree: <tt class="literal">/MyConnectionFactory</tt>
        and <tt class="literal">/factories/cf</tt>. The connection factory will use the default
        remoting connector. To use a different remoting connector with the connection factory
        change the <tt class="literal">Connector</tt> attribute to specify the service name of the connector you wish to use.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="conf.connectionfactory.attributes"></a>8.7.1.&nbsp;
           We now discuss the MBean attributes of the ConnectionFactory MBean
       </h3></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.destination.connectionfactory.attributes.clientid"></a>8.7.1.1.&nbsp;ClientID</h4></div></div><div></div></div><p>
              Connection factories can be pre-configured with a client id. Any connections created using this connection factory will obtain this client id
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.destination.connectionfactory.attributes.jndibindings"></a>8.7.1.2.&nbsp;JNDIBindings</h4></div></div><div></div></div><p>
              Returns a list of the JNDI bindings for this connection factory
           </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.destination.connectionfactory.attributes.prefetchsize"></a>8.7.1.3.&nbsp;PrefetchSize</h4></div></div><div></div></div><p>
            Each client side consumer maintains a local buffer of messages from which it consumes. The server typically sends messages as fast as it can
            to the consumer, and when the consumer is full it sends the server a "stop" message to say it is full.
            When it clears enough space it sends a "start" message to ask the server to continue sending messages.
            The prefetchSize determines the size of this buffer. Larger values give better throughput.
         </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.destination.connectionfactory.attributes.tempqueuepaging"></a>8.7.1.4.&nbsp;Temporary queue paging parameters</h4></div></div><div></div></div><p>DefaultTempQueueFullSize, DefaultTempQueuePageSize, DefaultTempQueueDownCacheSize are optional attributes that determine the default paging parameters to be used for
       any temporary destinations scoped to connections created using this connection factory. See the section on paging channels for more information
       on what these values mean.
       They will default to values of 200000, 2000 and 2000 respectively if ommitted.
       </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.destination.connectionfactory.attributes.dupsokbatchsize"></a>8.7.1.5.&nbsp;DupsOKBatchSize</h4></div></div><div></div></div><p>When using a session with acknowledge mode of DUPS_OK_ACKNOWLEDGE this setting determines how many acknowledgments it will buffer locally
      before sending. The default value is <tt class="literal">2000</tt>
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="conf.destination.connectionfactory.attributes.connector"></a>8.7.1.6.&nbsp;Connector</h4></div></div><div></div></div><p>This specifies which remoting connector this connection factory uses. Different connection factories can use different connectors.
         </p><p>For instance you could deploy one connection factory that creates connections that use the HTTP transport to communicate to the server and another
         that creates connections that use the bisocket transport to communicate.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="conf.connector"></a>8.8.&nbsp;Configuring the remoting connector</h2></div></div><div></div></div><p>
         JBoss Messaging uses JBoss Remoting  for all client to server communication.
         For full details of what JBoss Remoting is capable of and how it is configured please
         consult the JBoss Remoting documentation.
      </p><p>
         The default configuration includes a single remoting connector which is used by the
         single default connection factory. Each connection factory can be configured to use
         its own connector.
      </p><p>
         The default connector is configured to use the remoting bisocket transport. The bisocket transport is a TCP socket based transport
         which only listens and accepts connections on the server side. I.e. connections are always initiated from the client side. This means
         it works well in typical firewall scenarios where only inbound connections are allowed on the server. Or where onlu outbound connections are
         allowed from the client.
      </p><p>
        The bisocket transport can be configured to use SSL where a higher level of security is required.
        </p><p>
        The other supported transport is the HTTP transport. This uses the HTTP protocol to communicate between client and server. Data is received on the client
        by the client periodically polling the server for messages. This transport is well suited to situations where there is a firewall between client and server
        which only allows incoming HTTP traffic on the server.
        Please note this transport will not be as performant as the bisocket transport due to the nature of polling and the HTTP protocl. Also please note it is not
        designed for high load situations.
      </p><p>No other remoting transports are currently supported by JBoss Messaging</p><p>
         You can look at remoting configuration under:
       </p><p>
          &lt;JBoss&gt;/server/&lt;YourMessagingServer&gt;/deploy/jboss-messaging.sar/remoting-service.xml
       </p><p>
          By default JBoss Messaging binds to ${jboss.bind.address} which can be defined by:
          ./run.sh -c &lt;yourconfig&gt; -b yourIP.
       </p><p>
          You can change remoting-service.xml if you want for example use a
          different communication port.
       </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>Please be wary of changing other settings as they can have an adverse effect on the system</div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="conf.servicebindingmanager"></a>8.9.&nbsp;ServiceBindingManager</h2></div></div><div></div></div><p>If you are using the JBoss AS ServiceBindingManager to provide different servers with different port ranges, then you must make sure that the JBoss Messaging
     remoting configuration specified in the JBoss Messaging section of the ServiceBindingManager xml file exactly matches that in remoting-service.xml
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="conf.callback"></a>8.10.&nbsp;Configuring the callback</h2></div></div><div></div></div><p>
         JBoss Messaging uses a callback mechanism from Remoting that needs a Socket for callback operations. These socket properties are passed to the server by a remote call when the connection is being estabilished. As we said before we will support bidirectional protocols in future releases.
      </p><p>
         By default JBoss Messaging will execute InetAddress.getLocalHost().getHostAddress() to access your local host IP, but in case you need to setup a different IP, you can define a system property in your java arguments:
      </p><p>
      Use java -Djboss.messaging.callback.bind.address=YourHost - That will determine the callBack host in your client.
      </p><p>
      The client port will be selected randomly for any non used port. But if you defined -Djboss.messaging.callback.bind.port=NumericPort in your System Properties that number is going to be used for the call back client port.
      </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="examples.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="c_configuration.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;7.&nbsp;Running the Examples&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;9.&nbsp;JBoss Messaging Clustering Configuration</td></tr></table></div></body></html>